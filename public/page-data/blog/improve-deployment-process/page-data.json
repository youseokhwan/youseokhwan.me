{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/blog/improve-deployment-process/","result":{"data":{"markdownRemark":{"html":"<p>현재 이 블로그의 배포 프로세스는 다음과 같다.</p>\n<ol>\n<li>포스트를 작성 및 수정하거나, React 파일 변경(UI 업데이트 등) 후 push</li>\n<li>Netlify에서 변경을 감지하면, 서버에서 gatsby build 명령어 실행</li>\n<li>서버에서 진행한 빌드의 결과물인 public/을 호스팅</li>\n</ol>\n<p>배포 프로세스에 문제는 없으나, 반영되는 속도가 아쉬웠다.\n로컬에서 gatsby build를 실행하면 약 10초 정도 걸리는데, Netlify에선 2분 넘게 소요된다.\nUI 업데이트같은 큰 변경은 간헐적으로 배포하니 괜찮지만,\n오타 수정같은 경우는 commit마다 변경 사항이 적고, push 주기가 짧기때문에 꽤 답답했다.</p>\n<p>시간 단축에 비하면 CPU 사용량이 부담되는 상황은 아니였기에 로컬 빌드 방식으로 변경해보았다.</p>\n<hr>\n<h2>Git Subtree를 이용하여 deploy branch 분리</h2>\n<p>git subtree를 이용하면 여러 repository를 한 repository에서 관리할 수 있다.\n여기서는 public/을 하위 repository로 두고, 별도의 branch로 관리하는 목적으로 사용했다.</p>\n<h3>empty branch 만들기</h3>\n<p>--orphan 명령어를 이용해 기존 커밋 내역을 계승하지 않는 deploy라는 empty branch를 만든다.\n<del>orphan 단어 뜻이 너무 직접적이여서 당황스러웠다.</del></p>\n<pre class=\"grvsc-container github-light-theme grvsc-ps-t4tStz\" data-language=\"bash\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">git checkout --orphan deploy</span></span></span></code></pre>\n<p>자동으로 stage된 파일들을 해제하고, commit, push하여 remote에 반영한다.\n--allow-empty는 변경 사항이 없더라도 commit 할 수 있게 해준다.</p>\n<pre class=\"grvsc-container github-light-theme grvsc-ps-t4tStz\" data-language=\"bash\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">git reset</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">git commit --allow-empty -m </span><span class=\"grvsc-tiszgT-8 grvsc-t4tStz-10\">&quot;initial commit&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">git push origin deploy</span></span></span></code></pre>\n<p>empty branch가 만들어진 것을 확인할 수 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 68.71165644171779%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAACbUlEQVR42m1SW08TQRTeP6NYbPGdRHkSfqI+yoMIiQ9CubUFIcaYQBQU4wOSIFiwt1m2e53bzn6embZxazjJl+/s7JnvzLl4tccPivmn81haWsTi4nMsLDzD3JM51GpVzNVqqFQqhEeOZ2dHqJRQrVZd7MzMQ9SqVeO9WXuL1yur2N7ZwebWNt6tb2Bvfx8Hh4d4f3CIVmsPzVYLjWbT/d+ob1LsLhqN0Xej2cIu+ev1LSy/WoaXZRxxnEFqg5RLpJmEkIqgIVVO5xYaijijsygVUMbAmimAosQZ5/D8fg/dbg8dQjAcQihFl0mMRCX5jse+EsSUkCecEnMkqUXm/DCKXVJPizaC/kdE/hGS4NhBp6eAOgPkN8fGcv4Dx7/qWPmyjPr3Vdze/URGlSklkec5iqKApod4Sg4Rh1eQvEOZ24Qb5KpHNTDHIrt1XOg+Ov4FTq6P8OLTS5z+/owBS3HTD12LrFlRjwuNgR8hSDRYlMOPiWODkBsqv0AmDPUQztd0jw0jfDg/QTvoIYpSaoVG2WgoGfrMBwtC3IUxwiRDQsNJMkFNFuBCkqhETL0axgnCOEUaCxLX8O8C198pQU6TYSRoLwvXfA1NPdHUYMtqzHbSdjA2hkvphpckCZVpbK0jWEFDwTxNYMarMDH72wr9fzYxuwmdvo+YKpl6YVH8C7O+FbaIqPzuLa0SlTU5L8faCnospN3Mp5KNBMeB9pKgfmla6KtuG8cXX4lv3DpwIaaqULnBn0EIFnKqpLj/hZNXWjsfXGLtbAsX7HrqfGJ29wbUe7vU5f8eZc0nB2WUE9wHK8gYo8WemrL+C1JgAJ/0u2BgAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"empty-branch.png\"\n        title=\"\"\n        src=\"/static/ee2eb681e87e2f5a56055e85f4c11e79/a6d36/empty-branch.png\"\n        srcset=\"/static/ee2eb681e87e2f5a56055e85f4c11e79/222b7/empty-branch.png 163w,\n/static/ee2eb681e87e2f5a56055e85f4c11e79/ff46a/empty-branch.png 325w,\n/static/ee2eb681e87e2f5a56055e85f4c11e79/a6d36/empty-branch.png 650w,\n/static/ee2eb681e87e2f5a56055e85f4c11e79/e548f/empty-branch.png 975w,\n/static/ee2eb681e87e2f5a56055e85f4c11e79/3c492/empty-branch.png 1300w,\n/static/ee2eb681e87e2f5a56055e85f4c11e79/57e3f/empty-branch.png 2598w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<hr>\n<h2>로컬 빌드 방식으로 변경하기</h2>\n<h3>deploy branch로 빌드하기</h3>\n<p>현재, public/이 .gitignore에 추가돼있어 추적되지 않는 상태이다.\npublic/을 추적할 수 있도록 임시로 remote에 push한다.</p>\n<pre class=\"grvsc-container github-light-theme grvsc-ps-t4tStz\" data-language=\"bash\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">gatsby build</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">git add public/ -f</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">git commit -m </span><span class=\"grvsc-tiszgT-8 grvsc-t4tStz-10\">&quot;public/ 임시 추가&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">git push origin main</span></span></span></code></pre>\n<h3>Netlify 설정 변경</h3>\n<hr>\n<h2>Git Hooks을 이용하여 자동화</h2>\n<hr>\n<h3>참고</h3>\n<ul>\n<li><a href=\"https://log4day.tistory.com/64\">https://log4day.tistory.com/64</a></li>\n<li><a href=\"https://bum0w0.tistory.com/16\">https://bum0w0.tistory.com/16</a></li>\n</ul>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .github-light-theme {\n    background-color: #ffffff;\n    color: #000000;\n  }\n  .github-light-theme .grvsc-tiszgT-1 { color: #000000; }\n  .github-light-theme .grvsc-tiszgT-8 { color: #032F62; }\n  .github-light-theme .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(0, 0, 0, 0.05));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(0, 0, 0, 0.2));\n  }\n  body[data-theme=dark] .grvsc-ps-t4tStz { color: #ffffff; }\n  body[data-theme=dark] .grvsc-ps-t4tStz .grvsc-t4tStz-1 { color: #FFFFFF; }\n  body[data-theme=dark] .grvsc-ps-t4tStz .grvsc-t4tStz-10 { color: #9DCDF5; }\n  body[data-theme=dark] .grvsc-ps-t4tStz .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(0, 0, 0, 0.05));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(0, 0, 0, 0.2));\n  }\n</style>","frontmatter":{"title":"(작성중)블로그 배포 프로세스 개선하기","desc":"로컬 빌드 방식으로 변경하여 블로그 배포 시간 단축하기","thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"fixed","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAABY0lEQVR42qWSz0rDQBDG80K+h76EB/EigcTmECpC01OStpIKpaJGa2jxECJC1YqgrdAeWrEoRg/11ptSUAOJ+WeyceLWoPai+F02Ozu/b2dnQkRYKEIIRX8UEYOgMCbDECUWCKFJux8RAi+AubafnIXY5lPhhyb5GH56MI+3r7Rit6Xeua8+PvA8z/f9r6nAO46TWI/hw80+P7vPTtfYmdreahcig8F9lss2Gg2wsG1b1/XRaDQcDsvlMmCu60IcLAjzxalkWvLS2dzUWmG+Xsk0AV4pFNrtjiiK6XQ6n8+TJMlxnCRJqcUUzwu5XE5RFHCJb66vX54o11vLzeLC0bl2C5Fe7wIwAARBYFm2VCpVq1WKohiGkWWZpmlVVcdlPz9aBxv9Ha51untjGg5+oWEYUFsQBFA2bOEDroIuWJalaRoOjrsNo3rzAzywpKW4z5PTAqPvc8bZIfrNr5LkENE/9A6RFlAymZ562AAAAABJRU5ErkJggg=="},"images":{"fallback":{"src":"/static/98fcfce12a36f24ab204af21220cc3a9/e2aae/gatsby.png","srcSet":"/static/98fcfce12a36f24ab204af21220cc3a9/e2aae/gatsby.png 1600w","sizes":"1600px"},"sources":[{"srcSet":"/static/98fcfce12a36f24ab204af21220cc3a9/38a76/gatsby.webp 1600w","type":"image/webp","sizes":"1600px"}]},"width":1600,"height":899}}},"date":"2025-02-23","category":"Blog"}}},"pageContext":{"slug":"/blog/improve-deployment-process/"}},"staticQueryHashes":["2420453757"],"slicesMap":{}}